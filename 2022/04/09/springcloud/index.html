<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>springcloud（基础篇）1 | Big Sea的无名小站</title><meta name="keywords" content="springcloud"><meta name="author" content="ZZH-深夜开发版"><meta name="copyright" content="ZZH-深夜开发版"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="微服务技术栈（更新中）">
<meta property="og:type" content="article">
<meta property="og:title" content="springcloud（基础篇）1">
<meta property="og:url" content="http://example.com/2022/04/09/springcloud/index.html">
<meta property="og:site_name" content="Big Sea的无名小站">
<meta property="og:description" content="微服务技术栈（更新中）">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/09/LP7By8.png">
<meta property="article:published_time" content="2022-04-09T13:07:47.000Z">
<meta property="article:modified_time" content="2022-04-15T08:51:00.434Z">
<meta property="article:author" content="ZZH-深夜开发版">
<meta property="article:tag" content="springcloud">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/04/09/LP7By8.png"><link rel="shortcut icon" href="https://s1.ax1x.com/2022/03/19/qApUFH.png"><link rel="canonical" href="http://example.com/2022/04/09/springcloud/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'springcloud（基础篇）1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-04-15 16:51:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><div class="aplayer" data-id="7199229953" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="none"></div><link rel="stylesheet" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s1.ax1x.com/2022/03/19/qAmLNt.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2022/04/09/LP7By8.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Big Sea的无名小站</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">springcloud（基础篇）1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-04-09T13:07:47.000Z" title="Created 2022-04-09 21:07:47">2022-04-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-04-15T08:51:00.434Z" title="Updated 2022-04-15 16:51:00">2022-04-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java%E5%AD%A6%E4%B9%A0/">java学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>16min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="springcloud（基础篇）1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h6 id="前置知识rpc-使用rpc协议，他比http更适合项目内部通信"><a href="#前置知识rpc-使用rpc协议，他比http更适合项目内部通信" class="headerlink" title="前置知识rpc:使用rpc协议，他比http更适合项目内部通信"></a>前置知识rpc:使用rpc协议，他比http更适合项目内部通信</h6><p>一个一级的域名可以带多个二级域名：<a target="_blank" rel="noopener" href="http://www.zzh.com/">www.zzh.com</a>  test.zzh.com  it.zzh.com<br>子工程引入父工程pom.xml<parent>依赖就可以使用父工程的所有dependiences和定义的类</parent></p>
<h6 id="rpc协议："><a href="#rpc协议：" class="headerlink" title="rpc协议："></a>rpc协议：</h6><p>rpc协议规定允许互联网中的一台主机程序调用另一台主机程序，而程序员无需对这个交互过程进行编程。在rpc协议中强调当A程序调用B程序中的功能或方法时，A是不知道B中的方法具体实现的。效率比http高。<br>rpc使用注册中心：注册中心有点像控制器：a—-&gt;注册中心(通知a，b的地址在哪)——&gt;b,a拿到b是通过注册中心，而不是像http（如nginx）那样直连<br>相当于内部调用另一个服务器的程序，可以用httpClients类去调用另一个客户端</p>
<p>小tips：bean要定义在配置类，而启动类本身也是配置类<br>ctrl+h发现实现类，12Ribbon-负载均衡原理学debug看源码<br>服务和实例：服务指的是比如说订单服务，实例是可以由多个端口都访问到这个服务的不同端口的映射，比如8080,8081端口都访问userservice</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LM0kTJ.md.png"></p>
<p>这就代表启动相同类的多个服务，或者启动不同的模块，达到服务并行，相当于启动多个模块相互调用，也就是微服务<br>ctrl+p显示所有的参数</p>
<h6 id="nginx回顾："><a href="#nginx回顾：" class="headerlink" title="nginx回顾："></a>nginx回顾：</h6><p>需要启动多个端口如8080,8081,8082,然后命名一个总端口如80，然后启动的时候访问80端口，会负载均衡到这3个端口，但是需要启动nginx和这三个端口所对应的服务</p>
<h6 id="微服务对比："><a href="#微服务对比：" class="headerlink" title="微服务对比："></a>微服务对比：</h6><p><img src="/2022/04/09/springcloud/dc64d1e3c6dbd827.png"></p>
<p><img src="/2022/04/09/springcloud/836d469dd1f17448.png"></p>
<h6 id="服务拆分注意事项（误区）："><a href="#服务拆分注意事项（误区）：" class="headerlink" title="服务拆分注意事项（误区）："></a>服务拆分注意事项（误区）：</h6><p>拆分：解耦合。你想在支付模块里直接查订单相关的，没门，但是可以在内部调用暴露接口的订单服务</p>
<p><img src="/2022/04/09/springcloud/49a4496eb49782c2.png"></p>
<h6 id="具体应用根据订单id查询订单功能："><a href="#具体应用根据订单id查询订单功能：" class="headerlink" title="具体应用根据订单id查询订单功能："></a>具体应用根据订单id查询订单功能：</h6><p>具体实现：各个模块发http请求,去调用另一个模块的功能</p>
<p><img src="/2022/04/09/springcloud/67056b221fbcb0c7.png"></p>
<h6 id="实现原理："><a href="#实现原理：" class="headerlink" title="实现原理："></a>实现原理：</h6><p><img src="/2022/04/09/springcloud/87fb7b97447937f6.png"></p>
<p>代码实现：RestTemplate，模块到模块发送http请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.zzh.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(clients = UserClient.class,defaultConfiguration = DefaultFeignConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建RestTemplate并注入Spring容器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* @Bean</span></span><br><span class="line"><span class="comment">    public IRule randomRule() &#123;</span></span><br><span class="line"><span class="comment">        return new RandomRule();</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟发出请求（内部之间发送请求）</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;<span class="comment">//在业务层小小的封装一下，在返回（处理业务）</span></span><br><span class="line">    <span class="comment">// 1.查询订单</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">    <span class="comment">// 2.利用RestTemplate发起http请求，查询用户</span></span><br><span class="line">    <span class="comment">// 2.1.url路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br><span class="line">    <span class="comment">// 2.2.发送http请求，实现远程调用,返回的是json,但是写User.class它会帮你把json的数据类型给你转换为User类型</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);<span class="comment">//getForObject代表get请求，url相当于浏览器输入url</span></span><br><span class="line">    <span class="comment">// 3.封装user到Order...</span></span><br><span class="line">    order.setUser(user);</span><br><span class="line">    <span class="comment">// 4.返回</span></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="keyword">private</span> Long userId;<span class="comment">//根据userid发送http请求去查询user</span></span><br><span class="line">    <span class="keyword">private</span> User user;<span class="comment">//封装了user去用来调用用户类的信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/09/springcloud/6d7368c33420f7cd.png"></p>
<h6 id="Eureka注册中心："><a href="#Eureka注册中心：" class="headerlink" title="Eureka注册中心："></a>Eureka注册中心：</h6><p>因为会心跳续约，所以保证不会挂掉，得到的端口服务是健康的，如果8083不跳了，就从注册中心中删除，相当感知服务提供者的服务状态<br>步骤：1.引入eureka-client依赖。2.在application.yml中配置eureka地址</p>
<p><img src="/2022/04/09/springcloud/954f35a1719e8bcc.png"></p>
<p><img src="/2022/04/09/springcloud/fece674e06fa7d7f.png"></p>
<h6 id="eureka的使用："><a href="#eureka的使用：" class="headerlink" title="eureka的使用："></a>eureka的使用：</h6><p><img src="/2022/04/09/springcloud/a72f6906832905ff.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span><span class="comment">//euraka自动装配的开关</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置euraka，并把euraka自己注册到服务端</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment"># eureka服务端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务注册的信息：</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span> <span class="comment"># eureka的服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># eureka的地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span>  <span class="comment">#把自己也注入到eureka上,eureka集群之间相互联系的</span></span><br></pre></td></tr></table></figure>

<p>注册user-service   appliaction配置相当于替换了localhost</p>
<p><img src="/2022/04/09/springcloud/1a4983667eadf967.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">8081</span></span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//mysql:3306/cloud_user?useSSL=false</span></span><br><span class="line">    username: root</span><br><span class="line">    password: <span class="number">123</span></span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">  application:</span><br><span class="line">    name: userservice # eureka的服务名称</span><br><span class="line">mybatis:</span><br><span class="line">  type-aliases-<span class="keyword">package</span>: cn.itcast.user.pojo</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-<span class="keyword">case</span>: <span class="literal">true</span></span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    cn.itcast: debug</span><br><span class="line">  pattern:</span><br><span class="line">    dateformat: MM-dd HH:mm:ss:SSS</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:  # eureka的地址信息</span><br><span class="line">      defaultZone: http:<span class="comment">//127.0.0.1:10086/eureka</span></span><br><span class="line">pattern:</span><br><span class="line">  name: MM-dd HH:mm:ss:SSS</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/09/springcloud/45e835dba8085a75.png"></p>
<p><img src="/2022/04/09/springcloud/bb61eca55c6f9b2f.png"></p>
<p>但每个服务只有一个服务实例，我们需要多个服务实例。项目拷贝的快捷键是ctrl+D   -D代表参数，此时就注册了两个实例，就有两个。服务名称都是userservice，端口不同就会实现负载均衡</p>
<p><img src="/2022/04/09/springcloud/9b406f55c6a8e95c.png"></p>
<h6 id="在order-service拉取user-service的信息，并实现负载均衡："><a href="#在order-service拉取user-service的信息，并实现负载均衡：" class="headerlink" title="在order-service拉取user-service的信息，并实现负载均衡："></a>在order-service拉取user-service的信息，并实现负载均衡：</h6><p><img src="/2022/04/09/springcloud/8972e0f417c4ca10.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"><span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.查询订单</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">    <span class="comment">// 2.利用RestTemplate发起http请求，查询用户</span></span><br><span class="line">    <span class="comment">// 2.1.url路径,写服务名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br><span class="line">    <span class="comment">// 2.2.发送http请求，实现远程调用,并且会帮你把json的数据类型给你转换为User类型</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">    <span class="comment">// 3.封装user到Order</span></span><br><span class="line">    order.setUser(user);</span><br><span class="line">    <span class="comment">// 4.返回</span></span><br><span class="line">    <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span><span class="comment">//发出的请求会负载均衡到多个端口8081/8082</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>小结：</p>
<p><img src="/2022/04/09/springcloud/0f7cba0aaf1cb60d.png"></p>
<h6 id="Ribbon负载均衡："><a href="#Ribbon负载均衡：" class="headerlink" title="Ribbon负载均衡："></a>Ribbon负载均衡：</h6><p><img src="/2022/04/09/springcloud/LVzJEj.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LoadBalanced</span>代表restTemplate发出的请求要被ribbon拦截处理</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/09/springcloud/LZSIS0.png"></p>
<h6 id="Ribbon负载均衡策略："><a href="#Ribbon负载均衡策略：" class="headerlink" title="Ribbon负载均衡策略："></a>Ribbon负载均衡策略：</h6><p><img src="/2022/04/09/springcloud/LZpMnS.png"></p>
<p>定义bean在配置类中</p>
<p><img src="/2022/04/09/springcloud/LZp5AH.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意，这种方式是所有（不管是userservice还是别的都是这个（随机分布）的规则），全体</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定某一个负载均衡</span></span><br><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span>  <span class="comment"># 负载均衡规则</span></span><br></pre></td></tr></table></figure>

<h6 id="ribbon饥饿加载（懒汉模式）："><a href="#ribbon饥饿加载（懒汉模式）：" class="headerlink" title="ribbon饥饿加载（懒汉模式）："></a>ribbon饥饿加载（懒汉模式）：</h6><p><img src="/2022/04/09/springcloud/LZChYd.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启饥饿加载</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="comment"># 指定饥饿加载的服务名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">userservice</span>  <span class="comment">#多个饥饿加载</span></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<p><img src="/2022/04/09/springcloud/LZiADf.png"></p>
<h6 id="nacos注册中心："><a href="#nacos注册中心：" class="headerlink" title="nacos注册中心："></a>nacos注册中心：</h6><p>打开nacos的bin目录，启动命令：startup.cmd -m standalone</p>
<p><img src="/2022/04/09/springcloud/Lezugx.png"></p>
<p>父工程：如何子工程调用父工程即可使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>客户端：（各个子模块）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos客户端依赖包 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--nacos的配置管理依赖--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8088</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/cloud_order?useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line"><span class="comment">#注册</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos服务地址</span></span><br></pre></td></tr></table></figure>

<p>此时启动就会启动nacos</p>
<h6 id="nacos服务分级存储模型："><a href="#nacos服务分级存储模型：" class="headerlink" title="nacos服务分级存储模型："></a>nacos服务分级存储模型：</h6><p><img src="/2022/04/09/springcloud/Lm9IZ8.png"></p>
<p><img src="/2022/04/09/springcloud/LmPC0f.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注册</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos服务地址</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment">#自定义，hz代表杭州 此时启动俩个userapplication， 在修改为sh在启动，就可以保证是两个集群</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/09/springcloud/LmF4pQ.png"></p>
<p><img src="/2022/04/09/springcloud/LmkSXR.png"></p>
<h6 id="nacosRule-我们想实现orderservice优先使用本地集群的userservice：给order属性集群也进行配置"><a href="#nacosRule-我们想实现orderservice优先使用本地集群的userservice：给order属性集群也进行配置" class="headerlink" title="nacosRule,我们想实现orderservice优先使用本地集群的userservice：给order属性集群也进行配置"></a>nacosRule,我们想实现orderservice优先使用本地集群的userservice：给order属性集群也进行配置</h6><p>默认是hz集群和sh集群都会被访问，依然选择轮训方案，所以实质需要修改负载均衡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#orderservice也分为hz集群，和sh集群，详情看图  </span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> </span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> </span><br></pre></td></tr></table></figure>

<p>更改配置后，优先访问本地集群，之后访问本地集群采用随机方式：</p>
<p><img src="/2022/04/09/springcloud/LmAKxJ.png"></p>
<p>若停掉本地的所有实例，则访问外地的（跨集群访问），比如上海的都停掉了，就会跨集群访问杭州的</p>
<p>总结：</p>
<p><img src="/2022/04/09/springcloud/LmEOtf.png"></p>
<h6 id="nacos根据权重负载均衡：权重越大，被访问频率越高，性能好的机器多劳动"><a href="#nacos根据权重负载均衡：权重越大，被访问频率越高，性能好的机器多劳动" class="headerlink" title="nacos根据权重负载均衡：权重越大，被访问频率越高，性能好的机器多劳动"></a>nacos根据权重负载均衡：权重越大，被访问频率越高，性能好的机器多劳动</h6><p><img src="/2022/04/09/springcloud/LmVG9O.png"></p>
<p>配置：<br><img src="/2022/04/09/springcloud/LmVdHI.png"></p>
<p>应用：版本升级不能直接挂服务器，让用户把请求打到别的地方，把8080停机，让用户都去访问8081，就像不停机升级</p>
<h6 id="Nacos注册中心环境隔离：对服务做隔离，被隔离的服务不能相互访问"><a href="#Nacos注册中心环境隔离：对服务做隔离，被隔离的服务不能相互访问" class="headerlink" title="Nacos注册中心环境隔离：对服务做隔离，被隔离的服务不能相互访问"></a>Nacos注册中心环境隔离：对服务做隔离，被隔离的服务不能相互访问</h6><p><img src="/2022/04/09/springcloud/Lmex1O.md.png"></p>
<p><img src="/2022/04/09/springcloud/LmmjVs.png"></p>
<p><img src="/2022/04/09/springcloud/LmnpGV.png"></p>
<p><img src="/2022/04/09/springcloud/LmnFr4.md.png"></p>
<p><img src="/2022/04/09/springcloud/LmnmPx.png"></p>
<p><img src="/2022/04/09/springcloud/Lmnlse.md.png"></p>
<p>总结：此时orderservice和userservice就不能相互访问了，阴阳隔离</p>
<p><img src="/2022/04/09/springcloud/LmnXQO.png"></p>
<h6 id="nacos细节分析："><a href="#nacos细节分析：" class="headerlink" title="nacos细节分析："></a>nacos细节分析：</h6><p>消费者拉取不是每一次都拉取，拉取下来后缓存到一个列表中，之后直接请求缓存就行了，然后消费者挑一个负载均衡的服务地址再去远程调用就好了<br>默认情况下所有实例就是临时实例，可以自动停掉，宕机可以直接踢掉（非亲生），不健康直接挂掉<br>非临时实例需要配置，去询问（亲生），不会把这个实例剔除，而是等待，等待恢复健康继续使用，除非手动删除<br>nacos通过主动推送，实时性好,euraka比较差，这里我们建议使用临时的，这样对服务器的负载小</p>
<p><img src="/2022/04/09/springcloud/LmuCFI.png"></p>
<p><img src="/2022/04/09/springcloud/LmGJoD.png"></p>
<p>总结：<br>nacos:</p>
<p>AP:强调服务的可用性<br>cp:非临时实例，强调数据可靠性<br>eureka不支持切换</p>
<p><img src="/2022/04/09/springcloud/LmGdSA.png"></p>
<h6 id="nacos统一配置管理："><a href="#nacos统一配置管理：" class="headerlink" title="nacos统一配置管理："></a>nacos统一配置管理：</h6><p>现阶段问题：所有service都要修改配置文件，配置文件配置后需要重启，重启代价还很大，需要实现统一的管理，实现热更新，也就是配置管理服务<br>配置热更新：<br><img src="/2022/04/09/springcloud/Lmw9KJ.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/12/LmwGPf.png"></p>
<p><strong>注意：这里只放一些有开关性质的配置</strong>，比如热部署，或者有true,false性质的配置，比如日期，有时候用yyyy-MM-dd格式，有时候用别的日期显示方法格式，需要热部署</p>
<h6 id="微服务获取这些配置："><a href="#微服务获取这些配置：" class="headerlink" title="微服务获取这些配置："></a>微服务获取这些配置：</h6><p>userservice-dev.yaml会有配置伏笔，后面加-(dev&#x2F;test)spring就知道你这个文件是什么命名空间了，注意不要在nacos的dev群组里去创建配置，因为userservice在public的group里，只能读取group的配置文件，也就是说<strong>同组配置热部署的配置文件才有效</strong></p>
<p>去哪读取，读取谁？bootstrap.yml文件，比application.yml优先级更高,会优先去加载，把nacos的配置地址都放入到bootstrap.yml中，之后会与application合并</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nacos配置文件，与nacos界面的名字一样</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/09/springcloud/Lm01OJ.png"></p>
<p>步骤：<br>在userservice配置第一步的依赖</p>
<p><img src="/2022/04/09/springcloud/LmBp7R.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String dateformat;</span><br><span class="line"> <span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">now</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(properties.getDateformat()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//此时8081和8082测试格式都是yyyy-mm-dd,一份配置，多份使用</span></span><br></pre></td></tr></table></figure>

<h6 id="配置的热更新："><a href="#配置的热更新：" class="headerlink" title="配置的热更新："></a>配置的热更新：</h6><p>nacos中把模版配置修改为yyyy年mm月dd日 HH:mm:ss并点击发布并确认，但是刷新后没变化<br><img src="https://s1.ax1x.com/2022/04/12/LmcD81.png"></p>
<p><strong>不用属性注入（无value）的情况</strong>（相当于复习），通过前缀把yaml中的属性进行初始化赋值，并用@component把他做成spring的bean,就可以任意使用了，并且有初始值，用get方法获取值</p>
<p><img src="/2022/04/09/springcloud/LmccDO.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PatternProperties properties;</span><br><span class="line"><span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">now</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(properties.getDateformat()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="微服务的多环节配置共享："><a href="#微服务的多环节配置共享：" class="headerlink" title="微服务的多环节配置共享："></a>微服务的多环节配置共享：</h6><p>配一次在哪个环境都共享：<br>spring.application.name不带后缀名（-dev）就实现了配置共享<br>限度去bootstrap的配置文件，读取到运行环境</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给文件添加属性</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名    所以可以读到userservice.yaml和userservice-dev.yaml</span></span><br></pre></td></tr></table></figure>

<p><img src="https://s3.bmp.ovh/imgs/2022/04/12/1c7f4026048b7dac.png"></p>
<p>在user-service服务中，修改PatternProperties类，读取新添加的属性：</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/04/12/aa955edf09134425.png"></p>
<p>在user-service服务中，修改UserController，添加一个方法：</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/04/12/3360c2198e76de81.png"></p>
<p>运行两个UserApplication，使用不同的profile</p>
<p>修改UserApplication2这个启动项，改变其profile值,修改为测试环境：</p>
<p><img src="/2022/04/09/springcloud/image-20210714173538538-16497617267393.png" alt="image-20210714173538538"></p>
<p><img src="/2022/04/09/springcloud/image-20210714173519963-16497617267394.png" alt="image-20210714173519963"></p>
<p>这样，UserApplication(8081)使用的profile是dev，UserApplication2(8082)使用的profile是test。 <strong>这种方法和bootstrap配置的环境最后都合并到application中也就是nacos名字和application的名字想映射</strong></p>
<p>启动UserApplication和UserApplication2</p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8081/user/prop%EF%BC%8C%E7%BB%93%E6%9E%9C%EF%BC%9A">http://localhost:8081/user/prop，结果：</a></p>
<p><img src="/2022/04/09/springcloud/image-20210714174313344-16497617267395.png" alt="image-20210714174313344"></p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8082/user/prop%EF%BC%8C%E7%BB%93%E6%9E%9C%EF%BC%9A">http://localhost:8082/user/prop，结果：</a></p>
<p><img src="/2022/04/09/springcloud/image-20210714174424818-16497617267396.png" alt="image-20210714174424818"></p>
<p>可以看出来，不管是dev，还是test环境，都读取到了envSharedValue这个属性的值。<br>4）配置共享的优先级，本地配置低，线上优先级高<br>当nacos、服务本地同时出现相同属性时，优先级有高低之分：</p>
<p><img src="/2022/04/09/springcloud/image-20210714174623557-16497617267397.png" alt="image-20210714174623557"></p>
<h6 id="nacos的集群搭建：修改nginx-conf具体看集群搭建文件访问80端口，会负载均衡到8848-8849-8850三个nacos节点，yml代码只写一个80-负载均衡总端口-就够了"><a href="#nacos的集群搭建：修改nginx-conf具体看集群搭建文件访问80端口，会负载均衡到8848-8849-8850三个nacos节点，yml代码只写一个80-负载均衡总端口-就够了" class="headerlink" title="nacos的集群搭建：修改nginx.conf具体看集群搭建文件访问80端口，会负载均衡到8848,8849,8850三个nacos节点，yml代码只写一个80(负载均衡总端口)就够了"></a>nacos的集群搭建：修改nginx.conf具体看集群搭建文件访问80端口，会负载均衡到8848,8849,8850三个nacos节点，yml代码只写一个80(负载均衡总端口)就够了</h6><p><img src="https://s3.bmp.ovh/imgs/2022/04/12/05b612a42287595e.png"></p>
<h6 id="http客户端Feign代替restTemplate"><a href="#http客户端Feign代替restTemplate" class="headerlink" title="http客户端Feign代替restTemplate:"></a>http客户端Feign代替restTemplate:</h6><p><img src="https://s1.ax1x.com/2022/04/13/LKyv5Q.png"></p>
<p>引入：Feign是一个声明式的http客户端，官方地址：<a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">https:&#x2F;&#x2F;</a><a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">github.com</a><a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">&#x2F;</a><a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">OpenFeign</a><a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">&#x2F;feign</a></p>
<p>其作用就是帮助我们优雅的实现http请求的发送，解决上面提到的问题。<br>在orderservice引入feign客户端依赖<br>@FeignClient等同于bean,所以能注入，可读性好<br>feign不止完成了远程调用，<strong>还完成了负载均衡</strong>，以下配置都在调用者(orderservice)里去配置</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LKcSoD.md.png"></p>
<p>在orderservice中定义客户端</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LKckQI.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LKc3yq.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMp2E6.png"></p>
<h6 id="自定义feign的配置-http日志-："><a href="#自定义feign的配置-http日志-：" class="headerlink" title="自定义feign的配置(http日志)："></a>自定义feign的配置(http日志)：</h6><p><img src="https://s1.ax1x.com/2022/04/13/LM9Cbq.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMCHtf.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMCpWD.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;,)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">logLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(clients = UserClient.class,defaultConfiguration = DefaultFeignConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="feign的性能优化"><a href="#feign的性能优化" class="headerlink" title="feign的性能优化:"></a>feign的性能优化:</h6><p>对底层实现的改变，feign是声明式客户端，只是把我们的声明变成http请求，发http请求时还会用以下客户端，依然在发请求的地方配置（orderservice）</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMVKUA.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMZGJ1.md.png"></p>
<p>总结：</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMe6AJ.png"></p>
<h6 id="feign最佳实践："><a href="#feign最佳实践：" class="headerlink" title="feign最佳实践："></a>feign最佳实践：</h6><p>问题：orderservice和userservice接口都继承&#x2F;实现这个接口，相当于耦合了，相关联了，引入pom.xml后直接就能引入父工程所在包中所在的类</p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMJa9O.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/13/LMYCUx.png"></p>
<p>实现方式：<img src="https://s1.ax1x.com/2022/04/13/LMYYrj.png"></p>
<p><strong>因为spring扫描的是启动类所在的包,而userClient所在的模块和orderservice不是一个模块，扫描不到，不能创建bean，所以如果想</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserClient userClient;</span><br></pre></td></tr></table></figure>

<p><strong>自动注入的话会找不到另一个模块的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2022/04/13/LMY0iV.png"></p>
<p>前者是扫描包下所有feignClient,后者是精准打击一个</p>
<h6 id="gateway网关："><a href="#gateway网关：" class="headerlink" title="gateway网关："></a>gateway网关：</h6><p>作用：外部请求需要对身份的验证，一切请求先到网关，在到微服务，内部微服务可以通过feign相互调用，假如要去通过userservice这个服务要去查询，要经过网关，通过网关去找相应的服务进行查询（服务路由），可能也有多个服务（负载均衡）<br>网关负载均衡：面向用户访问微服务  ribbon:面向微服务之间  nginx面向nacos的</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlssVf.png"></p>
<h6 id="搭建网关服务："><a href="#搭建网关服务：" class="headerlink" title="搭建网关服务："></a>搭建网关服务：</h6><p>网关本身也是一个服务，需要注册到nacos上</p>
<p><img src="https://s1.ax1x.com/2022/04/14/Ll6z4O.png"></p>
<p>网关实现服务注册与发现(nacos)：<br>nginx可以选择请求去哪，网关能控制请求：</p>
<p><img src="https://s1.ax1x.com/2022/04/14/Llg0fS.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">nacos:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment">#网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由标示，必须唯一，随便起</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址，去找nacos配置实现负载均衡</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，判断请求是否符合规则</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 路径断言，判断路径是否是以/user开头，如果是则符合</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://orderservice</span> <span class="comment">#也可以写http</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br></pre></td></tr></table></figure>

<p>此时启动服务，访问<strong>localhost:10010&#x2F;user&#x2F;1</strong>和<strong>localhost:10010&#x2F;order&#x2F;101</strong>才能发送请求</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlRaRS.png"></p>
<p>总结：</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlR7Ix.png"></p>
<h6 id="路由断言工厂："><a href="#路由断言工厂：" class="headerlink" title="路由断言工厂："></a>路由断言工厂：</h6><p>predicates：路由断言，判断请求是否符合要求，符合则转发到路由目的地<br><img src="https://s1.ax1x.com/2022/04/14/LlWrlD.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlWhff.png"></p>
<p>remoteaddr对访问者的ip进行限制，我们用的是-path的格式</p>
<h6 id="路由过滤器的配置："><a href="#路由过滤器的配置：" class="headerlink" title="路由过滤器的配置："></a>路由过滤器的配置：</h6><p><img src="https://s1.ax1x.com/2022/04/14/LlhOzT.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gateway:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由标示，必须唯一</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址</span></span><br><span class="line">      <span class="attr">predicates:</span> <span class="comment"># 路由断言，判断请求是否符合规则</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 路径断言，判断路径是否是以/user开头，如果是则符合</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">lb://orderservice</span></span><br><span class="line">      <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br><span class="line">      <span class="comment">#filters:</span></span><br><span class="line">      <span class="comment">#- AddRequestHeader=Truth,zzh is freaking awesome! #给request请求加个请求头</span></span><br><span class="line">  <span class="attr">default-filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,zzh</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment">#给所有都添加过滤器</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id,<span class="meta">@RequestHeader(value=&quot;Truth&quot;,required=false)</span> String truth)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.queryById(id);</span><br><span class="line">    	System.out.println(<span class="string">&quot;truth&quot;</span>+truth);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：<img src="https://s1.ax1x.com/2022/04/14/LlI2J1.png"></p>
<h6 id="全局过滤器（非配置文件）："><a href="#全局过滤器（非配置文件）：" class="headerlink" title="全局过滤器（非配置文件）："></a>全局过滤器（非配置文件）：</h6><p>默认过滤器问题：配置文件是交给spring管理的，而一些逻辑spring处理不了，需要我们自己去管理<br><img src="https://s1.ax1x.com/2022/04/14/LlouTJ.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlTSc6.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有点像redis的token登录令牌，找header里面的authorization，只不过这个是用参数的</span></span><br><span class="line"><span class="comment">//@Order(1)//过滤器的执行顺序，越小优先级越高，或者接口实现</span></span><br><span class="line"><span class="meta">@Component</span><span class="comment">//注入到spring中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.通过全局上下文获取请求参数</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = request.getQueryParams();</span><br><span class="line">        <span class="comment">// 2.获取参数中的 authorization 参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">auth</span> <span class="operator">=</span> params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.判断参数值是否等于 admin</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(auth)) &#123;</span><br><span class="line">            <span class="comment">// 4.是，放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.否，拦截,直接拦截不太好，得友好提示用户返回状态码</span></span><br><span class="line">        <span class="comment">// 5.1.设置状态码</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);<span class="comment">//未登录401</span></span><br><span class="line">        <span class="comment">// 5.2.拦截请求</span></span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlL0hQ.png"></p>
<h6 id="过滤器执行顺序："><a href="#过滤器执行顺序：" class="headerlink" title="过滤器执行顺序："></a>过滤器执行顺序：</h6><p><img src="https://s1.ax1x.com/2022/04/14/LlLfNF.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlLqHK.png"></p>
<p>Global的GlobalFilter通过适配器GatewayFilterAdapter把全局GlobalFilter弄成GatewayFilter</p>
<h6 id="跨域问题处理："><a href="#跨域问题处理：" class="headerlink" title="跨域问题处理："></a>跨域问题处理：</h6><p>跨域：</p>
<p>注意order-service到user-service的请求与浏览器毛关系没有，不存在跨域问题</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LlX4yR.png"></p>
<p>cors是浏览器问服务器，你让不让我跨域？，有ajax的前端是8090端口，想去访问10010端口，会产生跨域问题</p>
<p><img src="https://s1.ax1x.com/2022/04/14/LljdAK.png"></p>
<h6 id="Docker"><a href="#Docker" class="headerlink" title="Docker:"></a>Docker:</h6><p><img src="https://s1.ax1x.com/2022/04/15/L8gp40.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/15/L8gAu4.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/15/L829Zd.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/15/L8RSpV.png"></p>
<p>虚拟机和docker的区别：<br><img src="https://s1.ax1x.com/2022/04/15/L8WIsS.png"></p>
<p>镜像与容器概念：不能修改镜像里面的东西，可以把镜像中的东西拷贝一份去修改<br><img src="https://s1.ax1x.com/2022/04/15/L8f1JI.md.png"></p>
<p>托管docker:dockerhub，可以拉取和下载镜像<br><img src="https://s1.ax1x.com/2022/04/15/L8hUc6.png"></p>
<h6 id="如何拉取下载镜像，首先知道结构："><a href="#如何拉取下载镜像，首先知道结构：" class="headerlink" title="如何拉取下载镜像，首先知道结构："></a>如何拉取下载镜像，首先知道结构：</h6><p>registry里面有很多优质的镜像</p>
<p><img src="https://s1.ax1x.com/2022/04/15/L84mUH.png"></p>
<p><img src="https://s1.ax1x.com/2022/04/15/L845M6.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="www.baidu.com">zzh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="vx:zzhcat">vx:zzhcat</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">我亦无他惟手熟尔</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springcloud/">springcloud</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/04/09/LP7By8.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s1.ax1x.com/2022/03/19/qAmO4P.md.jpg" target="_blank"><img class="post-qr-code-img" src="https://s1.ax1x.com/2022/03/19/qAmO4P.md.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s1.ax1x.com/2022/03/19/qAmj9f.md.jpg" target="_blank"><img class="post-qr-code-img" src="https://s1.ax1x.com/2022/03/19/qAmj9f.md.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/04/09/Zookeeper/"><img class="prev-cover" src="https://s1.ax1x.com/2022/04/09/Li4Tsg.md.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">大数据之zookeeper</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"><img class="next-cover" src="https://s1.ax1x.com/2022/03/19/qASjL8.md.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">数据结构与算法(不愿面对版)</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTc4My8zMjI0OQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s1.ax1x.com/2022/03/19/qAmLNt.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZZH-深夜开发版</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">19</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/53570539"><i class="fa-brands fa-bilibili"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://space.bilibili.com/53570539" target="_blank" title="b站"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="mailto:3081309881@gmail.com" target="_blank" title="qq邮件"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">很高兴认识你..</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86rpc-%E4%BD%BF%E7%94%A8rpc%E5%8D%8F%E8%AE%AE%EF%BC%8C%E4%BB%96%E6%AF%94http%E6%9B%B4%E9%80%82%E5%90%88%E9%A1%B9%E7%9B%AE%E5%86%85%E9%83%A8%E9%80%9A%E4%BF%A1"><span class="toc-number">1.</span> <span class="toc-text">前置知识rpc:使用rpc协议，他比http更适合项目内部通信</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#rpc%E5%8D%8F%E8%AE%AE%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">rpc协议：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nginx%E5%9B%9E%E9%A1%BE%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">nginx回顾：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AF%B9%E6%AF%94%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">微服务对比：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%88%E8%AF%AF%E5%8C%BA%EF%BC%89%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">服务拆分注意事项（误区）：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%BA%94%E7%94%A8%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95id%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">6.</span> <span class="toc-text">具体应用根据订单id查询订单功能：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">7.</span> <span class="toc-text">实现原理：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Eureka%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">Eureka注册中心：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#eureka%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">9.</span> <span class="toc-text">eureka的使用：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8order-service%E6%8B%89%E5%8F%96user-service%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%9A"><span class="toc-number">10.</span> <span class="toc-text">在order-service拉取user-service的信息，并实现负载均衡：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%9A"><span class="toc-number">11.</span> <span class="toc-text">Ribbon负载均衡：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="toc-number">12.</span> <span class="toc-text">Ribbon负载均衡策略：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#ribbon%E9%A5%A5%E9%A5%BF%E5%8A%A0%E8%BD%BD%EF%BC%88%E6%87%92%E6%B1%89%E6%A8%A1%E5%BC%8F%EF%BC%89%EF%BC%9A"><span class="toc-number">13.</span> <span class="toc-text">ribbon饥饿加载（懒汉模式）：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%9A"><span class="toc-number">14.</span> <span class="toc-text">nacos注册中心：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9E%8B%EF%BC%9A"><span class="toc-number">15.</span> <span class="toc-text">nacos服务分级存储模型：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacosRule-%E6%88%91%E4%BB%AC%E6%83%B3%E5%AE%9E%E7%8E%B0orderservice%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E9%9B%86%E7%BE%A4%E7%9A%84userservice%EF%BC%9A%E7%BB%99order%E5%B1%9E%E6%80%A7%E9%9B%86%E7%BE%A4%E4%B9%9F%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">16.</span> <span class="toc-text">nacosRule,我们想实现orderservice优先使用本地集群的userservice：给order属性集群也进行配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E6%A0%B9%E6%8D%AE%E6%9D%83%E9%87%8D%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%9A%E6%9D%83%E9%87%8D%E8%B6%8A%E5%A4%A7%EF%BC%8C%E8%A2%AB%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87%E8%B6%8A%E9%AB%98%EF%BC%8C%E6%80%A7%E8%83%BD%E5%A5%BD%E7%9A%84%E6%9C%BA%E5%99%A8%E5%A4%9A%E5%8A%B3%E5%8A%A8"><span class="toc-number">17.</span> <span class="toc-text">nacos根据权重负载均衡：权重越大，被访问频率越高，性能好的机器多劳动</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Nacos%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%8E%AF%E5%A2%83%E9%9A%94%E7%A6%BB%EF%BC%9A%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%81%9A%E9%9A%94%E7%A6%BB%EF%BC%8C%E8%A2%AB%E9%9A%94%E7%A6%BB%E7%9A%84%E6%9C%8D%E5%8A%A1%E4%B8%8D%E8%83%BD%E7%9B%B8%E4%BA%92%E8%AE%BF%E9%97%AE"><span class="toc-number">18.</span> <span class="toc-text">Nacos注册中心环境隔离：对服务做隔离，被隔离的服务不能相互访问</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E7%BB%86%E8%8A%82%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">19.</span> <span class="toc-text">nacos细节分析：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="toc-number">20.</span> <span class="toc-text">nacos统一配置管理：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%8E%B7%E5%8F%96%E8%BF%99%E4%BA%9B%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">21.</span> <span class="toc-text">微服务获取这些配置：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%EF%BC%9A"><span class="toc-number">22.</span> <span class="toc-text">配置的热更新：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%A4%9A%E7%8E%AF%E8%8A%82%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%EF%BC%9A"><span class="toc-number">23.</span> <span class="toc-text">微服务的多环节配置共享：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#nacos%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%EF%BC%9A%E4%BF%AE%E6%94%B9nginx-conf%E5%85%B7%E4%BD%93%E7%9C%8B%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE80%E7%AB%AF%E5%8F%A3%EF%BC%8C%E4%BC%9A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%88%B08848-8849-8850%E4%B8%89%E4%B8%AAnacos%E8%8A%82%E7%82%B9%EF%BC%8Cyml%E4%BB%A3%E7%A0%81%E5%8F%AA%E5%86%99%E4%B8%80%E4%B8%AA80-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%80%BB%E7%AB%AF%E5%8F%A3-%E5%B0%B1%E5%A4%9F%E4%BA%86"><span class="toc-number">24.</span> <span class="toc-text">nacos的集群搭建：修改nginx.conf具体看集群搭建文件访问80端口，会负载均衡到8848,8849,8850三个nacos节点，yml代码只写一个80(负载均衡总端口)就够了</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#http%E5%AE%A2%E6%88%B7%E7%AB%AFFeign%E4%BB%A3%E6%9B%BFrestTemplate"><span class="toc-number">25.</span> <span class="toc-text">http客户端Feign代替restTemplate:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89feign%E7%9A%84%E9%85%8D%E7%BD%AE-http%E6%97%A5%E5%BF%97-%EF%BC%9A"><span class="toc-number">26.</span> <span class="toc-text">自定义feign的配置(http日志)：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#feign%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">27.</span> <span class="toc-text">feign的性能优化:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#feign%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%9A"><span class="toc-number">28.</span> <span class="toc-text">feign最佳实践：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#gateway%E7%BD%91%E5%85%B3%EF%BC%9A"><span class="toc-number">29.</span> <span class="toc-text">gateway网关：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E7%BD%91%E5%85%B3%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="toc-number">30.</span> <span class="toc-text">搭建网关服务：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%96%AD%E8%A8%80%E5%B7%A5%E5%8E%82%EF%BC%9A"><span class="toc-number">31.</span> <span class="toc-text">路由断言工厂：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">32.</span> <span class="toc-text">路由过滤器的配置：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%88%E9%9D%9E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%89%EF%BC%9A"><span class="toc-number">33.</span> <span class="toc-text">全局过滤器（非配置文件）：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%EF%BC%9A"><span class="toc-number">34.</span> <span class="toc-text">过滤器执行顺序：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86%EF%BC%9A"><span class="toc-number">35.</span> <span class="toc-text">跨域问题处理：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Docker"><span class="toc-number">36.</span> <span class="toc-text">Docker:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8B%89%E5%8F%96%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%EF%BC%8C%E9%A6%96%E5%85%88%E7%9F%A5%E9%81%93%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-number">37.</span> <span class="toc-text">如何拉取下载镜像，首先知道结构：</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/" title="前端技术栈（交互响应篇）"><img src="https://s1.ax1x.com/2022/04/23/LW7w4I.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端技术栈（交互响应篇）"/></a><div class="content"><a class="title" href="/2022/04/23/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/" title="前端技术栈（交互响应篇）">前端技术栈（交互响应篇）</a><time datetime="2022-04-23T13:07:47.000Z" title="Created 2022-04-23 21:07:47">2022-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/09/Zookeeper/" title="大数据之zookeeper"><img src="https://s1.ax1x.com/2022/04/09/Li4Tsg.md.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="大数据之zookeeper"/></a><div class="content"><a class="title" href="/2022/04/09/Zookeeper/" title="大数据之zookeeper">大数据之zookeeper</a><time datetime="2022-04-09T13:07:47.000Z" title="Created 2022-04-09 21:07:47">2022-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/09/springcloud/" title="springcloud（基础篇）1"><img src="https://s1.ax1x.com/2022/04/09/LP7By8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="springcloud（基础篇）1"/></a><div class="content"><a class="title" href="/2022/04/09/springcloud/" title="springcloud（基础篇）1">springcloud（基础篇）1</a><time datetime="2022-04-09T13:07:47.000Z" title="Created 2022-04-09 21:07:47">2022-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="数据结构与算法(不愿面对版)"><img src="https://s1.ax1x.com/2022/03/19/qASjL8.md.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法(不愿面对版)"/></a><div class="content"><a class="title" href="/2022/03/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="数据结构与算法(不愿面对版)">数据结构与算法(不愿面对版)</a><time datetime="2022-03-29T13:07:47.000Z" title="Created 2022-03-29 21:07:47">2022-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" title="计算机基础（原理掌控篇）"><img src="https://s1.ax1x.com/2022/03/19/qAp4lq.md.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机基础（原理掌控篇）"/></a><div class="content"><a class="title" href="/2022/03/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" title="计算机基础（原理掌控篇）">计算机基础（原理掌控篇）</a><time datetime="2022-03-29T13:07:47.000Z" title="Created 2022-03-29 21:07:47">2022-03-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2022/04/09/LP7By8.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 By ZZH-深夜开发版</div><div class="footer_custom_text">很高兴认识你</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><div class="aplayer" data-id="7199229953" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="none"></div><link rel="stylesheet" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>